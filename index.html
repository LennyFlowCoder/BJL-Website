<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BJL Cinematic Universe</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --color-1: #ee7752;
            --color-2: #e73c7e;
            --color-3: #23a6d5;
            --color-4: #23d5ab;
        }
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #fff;
            background: linear-gradient(-45deg, var(--color-1), var(--color-2), var(--color-3), var(--color-4));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            overflow-x: hidden;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .main-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            position: absolute;
            top: 0;
            left: 0;
            box-sizing: border-box;
            background: rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, #fff, #ddd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.5s ease;
            background-size: 200% 200%;
            background-position: 0% 50%;
        }
        .logo:hover {
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            background-position: 100% 50%;
        }
        .header-controls { display: flex; align-items: center; gap: 1rem; }
        .view { display: none; width: 100%; }
        .view.active { display: block; }
        .auth-container, .main-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px 20px 20px 20px;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .glass-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            overflow: hidden;
            width: 100%;
            max-width: 450px;
            box-sizing: border-box;
        }
        h1, h2 { font-weight: 600; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .input-group input::placeholder, .input-group textarea::placeholder { color: rgba(255, 255, 255, 0.7); }
        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--color-4);
            background: rgba(0, 0, 0, 0.3);
        }
        .btn {
            background: linear-gradient(45deg, var(--color-3), var(--color-4));
            color: #fff;
            border: none;
            border-radius: 50px;
            padding: 15px 40px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .btn:active {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-primary { background: linear-gradient(45deg, var(--color-2), var(--color-1)); }
        .btn-secondary { background: transparent; border: 1px solid #fff; }
        .btn-link { background: none; color: #fff; text-decoration: underline; padding: 0; border: none; font-weight: 400; }
        .error { color: #ffc4c4; text-align: center; margin-top: 1rem; min-height: 20px; font-weight: 600; }
        .success { color: #c8ffc4; text-align: center; margin-top: 1rem; }
        
        /* --- Admin Dashboard Redesign --- */
        .admin-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            width: 100%;
            max-width: 1200px;
            padding: 100px 2rem 2rem 2rem;
            box-sizing: border-box;
        }
        .admin-container .logo { text-align: center; grid-column: 1 / -1;}
        .admin-section { padding: 30px; }
        #user-list-section { grid-column: 1 / -1; }
        .user-item { background-color: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 1rem; display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; flex-wrap: wrap; }
        .user-item span { margin: 5px; }

        /* --- Disney+ Style Film Gallery --- */
        #film-gallery-section {
             width: 100%;
             padding: 0 2rem;
             box-sizing: border-box;
        }
        .film-carousel-container {
            width: 100%;
            overflow-x: auto;
            padding: 1rem 0;
        }
        .film-carousel-container::-webkit-scrollbar { display: none; }
        .film-carousel-container { -ms-overflow-style: none; scrollbar-width: none; }

        .film-carousel {
            display: flex;
            flex-direction: row;
            gap: 1.5rem;
            padding-bottom: 1rem;
        }
        .film-card {
            flex: 0 0 auto;
            width: 250px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .film-card:hover { transform: scale(1.05); }
        .film-card img { width: 100%; height: auto; display: block; }
        .film-card .film-info { display: none; }
        
        /* --- Modal & Other Styles --- */
        .modal { position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: none; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        #video-player { border-radius: 15px; max-height: 70vh; }
        .close-btn { position: absolute; top: 10px; right: 25px; color: #aaa; font-size: 38px; font-weight: bold; cursor: pointer; z-index: 2001; }
        .close-btn:hover { color: #fff; }

        @media (max-width: 768px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <a href="#" class="logo">BJL Cinematic Universe</a>
        <div id="header-controls" class="header-controls" style="display:none;">
            <span id="welcome-user"></span>
            <button id="logout-btn" class="btn btn-secondary">Logout</button>
        </div>
    </header>

    <main>
        <div id="auth-view" class="view active">
            <div class="auth-container">
                <div class="glass-box" id="auth-box-container">
                    <div id="login-box">
                        <h2 style="color: #fff; text-align: center;">Login</h2>
                        <form id="login-form">
                            <div class="input-group"><input type="email" id="login-email" required placeholder="E-Mail"></div>
                            <div class="input-group"><input type="password" id="login-password" required placeholder="Passwort"></div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Einloggen</button>
                            <p style="text-align: center; margin-top: 1rem;">Noch kein Konto? <a id="show-register" class="btn-link">Jetzt registrieren</a></p>
                        </form>
                    </div>
                    <div id="register-box" style="display:none;">
                        <h2 style="color: #fff; text-align: center;">Registrieren</h2>
                        <form id="register-form">
                            <div class="input-group"><input type="email" id="register-email" required placeholder="E-Mail"></div>
                            <div class="input-group"><input type="password" id="register-password" required placeholder="Passwort"></div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Registrieren</button>
                            <p style="text-align: center; margin-top: 1rem;">Bereits ein Konto? <a id="show-login" class="btn-link">Zum Login</a></p>
                        </form>
                    </div>
                    <p id="error-message" class="error"></p>
                </div>
            </div>
        </div>
        
        <div id="dashboard-view" class="view">
            <div class="main-content">
                <div id="code-entry-section" class="glass-box">
                    <h2 style="color: #fff; text-align: center;">Zugangscode erforderlich</h2>
                    <p style="text-align: center;">Gib deinen 6-stelligen Zugangscode ein, um die Filmgalerie freizuschalten.</p>
                    <form id="code-form">
                        <div class="input-group"><input type="text" id="access-code" placeholder="XXXXXX" maxlength="6" required style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;"></div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Freischalten</button>
                    </form>
                    <p id="code-error" class="error"></p>
                    <button id="request-code-btn" class="btn btn-link" style="margin-top: 1rem; display: block; text-align: center; width: 100%;">Noch keinen Code? Jetzt anfordern</button>
                    <p id="request-message" class="success" style="display:none;">Deine Anfrage wurde an den Administrator gesendet.</p>
                </div>
                <div id="film-gallery-section" style="display:none; width: 100%; max-width: 1200px;">
                    <h1 class="logo" style="margin-bottom: 1rem; font-size: 2.5rem;">Filmgalerie</h1>
                    <div class="film-carousel-container">
                        <div id="film-carousel" class="film-carousel"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-view" class="view">
             <div class="admin-container">
                <h1 class="logo" style="margin-bottom: 2rem; font-size: 3rem;">Admin Dashboard</h1>
                
                <div class="glass-box admin-section">
                    <h2>Code-Anfragen</h2>
                    <div id="code-requests-list"></div>
                </div>
                
                <div class="glass-box admin-section">
                    <h2>Neuen Film hochladen</h2>
                    <form id="upload-form">
                        <div class="input-group"><input type="text" id="film-title" placeholder="Filmtitel" required></div>
                        <div class="input-group"><textarea id="film-description" placeholder="Filmbeschreibung" required style="background: rgba(0,0,0,0.2); border-radius:10px; color: #fff;"></textarea></div>
                        <div class="input-group"><label>Coverbild:</label><input type="file" id="film-cover" accept="image/*" required></div>
                        <div class="input-group"><label>Videodatei:</label><input type="file" id="film-video" accept="video/*" required></div>
                        <button type="submit" class="btn btn-primary" style="width:100%">Film hochladen</button>
                        <p id="upload-success" class="success" style="display:none;">Film erfolgreich hochgeladen!</p>
                    </form>
                </div>

                <div id="user-list-section" class="glass-box admin-section" style="grid-column: 1 / -1;">
                    <h2>Benutzerübersicht</h2>
                    <div id="user-list"></div>
                </div>

                <div id="manage-films-section" class="glass-box admin-section" style="grid-column: 1 / -1;">
                    <h2>Filme verwalten</h2>
                    <div class="film-carousel-container">
                         <div id="manageable-film-list" class="film-carousel"></div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <div id="video-player-modal" class="modal">
        <span class="close-btn">&times;</span>
        <div class="modal-content">
            <video id="video-player" width="100%" controls controlslist="nodownload" oncontextmenu="return false;"></video>
            <h3 id="video-title" style="color: #fff; margin-top: 15px; padding: 0 10px;"></h3>
            <p id="video-description" style="padding: 0 10px;"></p>
        </div>
    </div>


    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyAKr4suek_0T5QzRzTtHUMxuA4Quulk6_k",
          authDomain: "bjl-cinematic-universe.firebaseapp.com",
          databaseURL: "https://bjl-cinematic-universe-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "bjl-cinematic-universe",
          storageBucket: "bjl-cinematic-universe.appspot.com",
          messagingSenderId: "1091318575562",
          appId: "1:1091318575562:web:aa0c594d2ef026f42c9f33",
          measurementId: "G-YHFLB8C8CR"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const ADMIN_UID = "w8T7zyLsaVcj2X9I4OYiYl93xy22";

        document.addEventListener('DOMContentLoaded', () => {
            const app = new App();
            app.init();
        });

        class App {
            constructor() {
                this.authManager = new AuthManager(this);
                this.codeManager = new CodeManager(this);
                this.filmManager = new FilmManager(this);
                this.uiManager = new UIManager();
            }

            init() {
                this.authManager.init();
                this.filmManager.init();
                this.codeManager.init();
            }

            async onAuthStateChange(user) {
                if (user) {
                    const isAdmin = user.uid === ADMIN_UID;
                    this.uiManager.showLoggedInHeader(user.email);
                    if (isAdmin) {
                        this.uiManager.showView('admin');
                        this.codeManager.displayCodeRequests();
                        this.codeManager.displayAllUsers();
                        this.filmManager.displayManageableFilms(); // <-- HIER HINZUGEFÜGT
                    } else {
                        this.uiManager.showView('dashboard');
                    }
                } else {
                    this.uiManager.showLoggedOutHeader();
                    this.uiManager.showView('auth');
                }
            }
        }

        class UIManager {
            constructor() { this.views = document.querySelectorAll('.view'); this.headerControls = document.getElementById('header-controls'); this.welcomeUser = document.getElementById('welcome-user'); }
            showView(viewId) { this.views.forEach(view => { view.classList.remove('active'); if (view.id === `${viewId}-view`) view.classList.add('active'); }); }
            showLoggedInHeader(email) { this.headerControls.style.display = 'flex'; this.welcomeUser.textContent = `Willkommen, ${email.split('@')[0]}`; }
            showLoggedOutHeader() { this.headerControls.style.display = 'none'; }
            displayError(message) { document.getElementById('error-message').textContent = message; }
            clearError() { document.getElementById('error-message').textContent = ''; }
        }

        class AuthManager {
            constructor(app) { this.app = app; }
            init() {
                auth.onAuthStateChanged(user => this.app.onAuthStateChange(user));
                document.getElementById('login-form').addEventListener('submit', e => { e.preventDefault(); this.login(); });
                document.getElementById('register-form').addEventListener('submit', e => { e.preventDefault(); this.register(); });
                document.getElementById('show-register').addEventListener('click', () => this._toggleAuthForms(true));
                document.getElementById('show-login').addEventListener('click', () => this._toggleAuthForms(false));
                document.getElementById('logout-btn').addEventListener('click', () => this.logout());
            }

            _toggleAuthForms(showRegister) {
                document.getElementById('login-box').style.display = showRegister ? 'none' : 'block';
                document.getElementById('register-box').style.display = showRegister ? 'block' : 'none';
                this.app.uiManager.clearError();
            }

            async register() {
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                this.app.uiManager.clearError();
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await db.collection('users').doc(userCredential.user.uid).set({
                        email: userCredential.user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Registrierung erfolgreich! Bitte einloggen.');
                    this._toggleAuthForms(false);
                } catch (error) { this.app.uiManager.displayError(error.message); }
            }

            async login() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                this.app.uiManager.clearError();
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) { this.app.uiManager.displayError(error.message); }
            }

            async logout() { await auth.signOut(); }
        }

        class CodeManager {
            constructor(app) { this.app = app; }
            init() {
                document.getElementById('request-code-btn').addEventListener('click', () => this.requestAccessCode());
                document.getElementById('code-form').addEventListener('submit', e => { e.preventDefault(); this.validateCode(); });
            }

            async requestAccessCode() {
                const user = auth.currentUser;
                if (!user) return;
                try {
                    await db.collection('codeRequests').doc(user.uid).set({
                        email: user.email,
                        requestedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    const requestMsg = document.getElementById('request-message');
                    requestMsg.style.display = 'block';
                    setTimeout(() => { requestMsg.style.display = 'none'; }, 4000);
                } catch (error) { console.error("Fehler bei Code-Anfrage:", error); alert("Fehler: Deine Anfrage konnte nicht gesendet werden."); }
            }

            displayCodeRequests() {
                const listElement = document.getElementById('code-requests-list');
                if (!listElement) return;
                db.collection('codeRequests').onSnapshot(snapshot => {
                    listElement.innerHTML = '';
                    if (snapshot.empty) {
                        listElement.innerHTML = '<p>Keine offenen Anfragen.</p>';
                        return;
                    }
                    snapshot.forEach(doc => {
                        const request = doc.data();
                        const item = document.createElement('div');
                        item.className = 'user-item';
                        item.innerHTML = `<span>${request.email}</span><button class="btn btn-primary btn-sm">Code erstellen</button>`;
                        item.querySelector('button').addEventListener('click', () => this.generateAndSendCode(request.email, doc.id));
                        listElement.appendChild(item);
                    });
                });
            }

            async generateAndSendCode(email, userId) {
                const newCode = Math.floor(100000 + Math.random() * 900000).toString();
                try {
                    await db.collection('accessCodes').add({
                        code: newCode,
                        userEmail: email,
                        isUsed: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    await db.collection('codeRequests').doc(userId).delete();
                    sendCodeByEmail(email, newCode);
                } catch (error) { console.error("Fehler beim Erstellen des Codes: ", error); alert("Code konnte nicht erstellt werden."); }
            }

            async displayAllUsers() {
                const listElement = document.getElementById('user-list');
                if (!listElement) return;
                try {
                    const snapshot = await db.collection('users').get();
                    listElement.innerHTML = '';
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        if (doc.id === ADMIN_UID) return;
                        const lastLogin = auth.currentUser.metadata.lastSignInTime ? new Date(auth.currentUser.metadata.lastSignInTime).toLocaleString('de-DE') : 'Unbekannt';
                        const item = document.createElement('div');
                        item.className = 'user-item';
                        item.innerHTML = `<span><strong>E-Mail:</strong> ${user.email}</span><span><strong>Letzter Login:</strong> ${lastLogin}</span>`;
                        listElement.appendChild(item);
                    });
                } catch (error) { console.error("Fehler beim Laden der Benutzer: ", error); }
            }

            async validateCode() {
                const codeInput = document.getElementById('access-code').value;
                const codeError = document.getElementById('code-error');
                codeError.textContent = '';
                try {
                    const snapshot = await db.collection('accessCodes').where('code', '==', codeInput).where('isUsed', '==', false).get();
                    if (snapshot.empty) {
                        codeError.textContent = 'Ungültiger oder bereits verwendeter Code.';
                        return;
                    }
                    const codeDoc = snapshot.docs[0];
                    if (codeDoc.data().userEmail !== auth.currentUser.email) {
                         codeError.textContent = 'Dieser Code ist nicht für dich bestimmt.';
                         return;
                    }
                    await db.collection('accessCodes').doc(codeDoc.id).update({ isUsed: true });
                    
                    document.getElementById('code-entry-section').style.display = 'none';
                    document.getElementById('film-gallery-section').style.display = 'block';
                    this.app.filmManager.loadFilmGallery();
                } catch (error) { console.error("Fehler bei Code-Validierung:", error); codeError.textContent = "Ein Fehler ist aufgetreten."; }
            }
        }
        
        class FilmManager {
            constructor(app) { this.app = app; }
            init() {
                const uploadForm = document.getElementById('upload-form');
                if (uploadForm) {
                    uploadForm.addEventListener('submit', e => { e.preventDefault(); this.uploadFilm(); });
                }
                document.querySelector('.close-btn').onclick = () => this.hideVideoPlayer();
                document.getElementById('video-player-modal').addEventListener('click', (e) => { if (e.target.id === 'video-player-modal' || e.target.classList.contains('modal-content')) this.hideVideoPlayer(); });
            }
            
            async uploadFilm() {
                const CLOUD_NAME = "dgsfozqb7", UPLOAD_PRESET = "pkd40q5y";
                const title = document.getElementById('film-title').value;
                const description = document.getElementById('film-description').value;
                const coverFile = document.getElementById('film-cover').files[0];
                const videoFile = document.getElementById('film-video').files[0];
                const uploadButton = document.querySelector('#upload-form button[type="submit"]');

                if (!title || !description || !coverFile || !videoFile) { alert('Bitte alle Felder ausfüllen.'); return; }
                
                uploadButton.disabled = true;
                uploadButton.textContent = 'Lade hoch...';

                try {
                    const uploadFileToCloudinary = async (file, resourceType) => {
                        const formData = new FormData();
                        formData.append('file', file);
                        formData.append('upload_preset', UPLOAD_PRESET);
                        const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/${resourceType}/upload`;
                        const response = await fetch(url, { method: 'POST', body: formData });
                        if (!response.ok) { const errorData = await response.json(); throw new Error(`Cloudinary Upload fehlgeschlagen: ${errorData.error.message}`); }
                        const data = await response.json();
                        return data.secure_url;
                    };

                    uploadButton.textContent = 'Lade Cover hoch...';
                    const coverURL = await uploadFileToCloudinary(coverFile, 'image');
                    uploadButton.textContent = 'Lade Video hoch...';
                    const videoURL = await uploadFileToCloudinary(videoFile, 'video');

                    await db.collection('films').add({
                        title,
                        description,
                        cover: coverURL,
                        video: videoURL,
                        uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const successMsg = document.getElementById('upload-success');
                    successMsg.style.display = 'block';
                    document.getElementById('upload-form').reset();
                    setTimeout(() => { successMsg.style.display = 'none'; }, 3000);

                } catch (error) {
                    console.error("Upload-Fehler:", error);
                    alert(`Ein Fehler ist beim Hochladen aufgetreten: ${error.message}`);
                } finally {
                    uploadButton.disabled = false;
                    uploadButton.textContent = 'Film hochladen';
                }
            }
            
            async loadFilmGallery() {
                const filmCarousel = document.getElementById('film-carousel');
                filmCarousel.innerHTML = '<p>Lade Filme...</p>';
                try {
                    const snapshot = await db.collection('films').orderBy('uploadedAt', 'desc').get();
                    filmCarousel.innerHTML = '';
                    if (snapshot.empty) {
                        filmCarousel.innerHTML = '<p>Keine Filme verfügbar.</p>';
                        return;
                    }
                    snapshot.forEach(doc => {
                        const film = doc.data();
                        const filmCard = document.createElement('div');
                        filmCard.className = 'film-card';
                        filmCard.innerHTML = `<img src="${film.cover}" alt="${film.title}">`;
                        filmCard.addEventListener('click', () => this.showVideoPlayer(film));
                        filmCarousel.appendChild(filmCard);
                    });
                } catch (error) { console.error("Fehler beim Laden der Filme: ", error); filmCarousel.innerHTML = '<p>Filme konnten nicht geladen werden.</p>';}
            }

            showVideoPlayer(film) { const modal = document.getElementById('video-player-modal'); document.getElementById('video-player').src = film.video; document.getElementById('video-title').textContent = film.title; document.getElementById('video-description').textContent = film.description; modal.classList.add('active'); }
            hideVideoPlayer() { const modal = document.getElementById('video-player-modal'); const videoPlayer = document.getElementById('video-player'); modal.classList.remove('active'); videoPlayer.pause(); videoPlayer.src = ""; }

            // NEUE FUNKTIONEN ZUM VERWALTEN UND LÖSCHEN
            async displayManageableFilms() {
                const filmList = document.getElementById('manageable-film-list');
                if (!filmList) return;

                filmList.innerHTML = '<p>Lade Filme zum Verwalten...</p>';
                try {
                    db.collection('films').orderBy('uploadedAt', 'desc').onSnapshot(snapshot => {
                        filmList.innerHTML = '';
                        if (snapshot.empty) {
                            filmList.innerHTML = '<p>Keine Filme zum Verwalten vorhanden.</p>';
                            return;
                        }
                        snapshot.forEach(doc => {
                            const film = { id: doc.id, ...doc.data() };
                            const filmCard = document.createElement('div');
                            filmCard.className = 'film-card';
                            filmCard.style.width = '200px'; 
                            
                            const deleteButton = document.createElement('button');
                            deleteButton.textContent = 'Löschen';
                            deleteButton.className = 'btn btn-primary';
                            deleteButton.style.margin = '10px';
                            deleteButton.onclick = () => this.deleteFilm(film.id, film.title);

                            filmCard.innerHTML = `<img src="${film.cover}" alt="${film.title}" style="cursor:default;">`;
                            filmCard.appendChild(deleteButton);
                            filmList.appendChild(filmCard);
                        });
                    });
                } catch (error) {
                    console.error("Fehler beim Laden der Filme zum Verwalten: ", error);
                    filmList.innerHTML = '<p>Filme konnten nicht geladen werden.</p>';
                }
            }

            async deleteFilm(filmId, filmTitle) {
                const isConfirmed = confirm(`Möchtest du den Film "${filmTitle}" wirklich löschen? Der Eintrag wird aus der App entfernt.`);

                if (isConfirmed) {
                    try {
                        await db.collection('films').doc(filmId).delete();
                        alert(`Der Film "${filmTitle}" wurde erfolgreich aus der App entfernt.`);
                        alert("WICHTIG: Um Speicherplatz freizugeben, lösche die Dateien jetzt manuell in deiner Cloudinary Media Library!");
                    } catch (error) {
                        console.error("Fehler beim Löschen des Films: ", error);
                        alert("Der Film konnte nicht aus der Datenbank gelöscht werden.");
                    }
                }
            }
        }
        
        function sendCodeByEmail(userEmail, accessCode) {
            const publicKey = 'NeKfQ5FAdlyo2prm9', serviceID = 'service_783ypuq', templateID = 'template_ed0rm88';
            emailjs.init(publicKey);
            const templateParams = { to_email: userEmail, access_code: accessCode, from_name: 'BJL Cinematic Universe' };
            emailjs.send(serviceID, templateID, templateParams)
                .then(res => alert(`Zugangscode wurde erfolgreich an ${userEmail} gesendet.`))
                .catch(err => { 
                    console.error('Fehler beim E-Mail-Versand:', err); 
                    alert(`FEHLER: E-Mail konnte nicht gesendet werden. Der Code für ${userEmail} lautet: ${accessCode}`); 
                });
        }
    </script>

</body>
</html>
was kann ich machen um die filme nicht manuell in cloudinary zu löschen sondern über die seite selber?
